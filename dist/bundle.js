(()=>{"use strict";var e;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(e||(e={}));class t{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}function n(e,t,n){const r=n.value;return{configurable:!0,enumerable:!1,get(){return r.bind(this)}}}class r{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class s extends r{constructor(){super(),this.projects=[]}static getInstace(){return this.instance||(this.instance=new s),this.instance}addProject(n,r,s){const i=new t(Math.random().toString(),n,r,s,e.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const i=s.getInstace();class l{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}var o=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class a extends l{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons `}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent=this.project.description}}o([n],a.prototype,"dragStartHandler",null),o([n],a.prototype,"dragEndHandler",null);var c=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class d extends l{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.element.id=`${this.type}-projects`,this.configure(),this.renderContent()}dragOverHandler(e){e.preventDefault(),e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&this.element.querySelector("ul").classList.add("droppable")}dropHandler(t){const n=t.dataTransfer.getData("text/plain");i.moveProject(n,"active"===this.type?e.Active:e.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),i.addListener((t=>{const n=t.filter((t=>"active"===this.type?t.status===e.Active:t.status===e.Finished));this.assignedProjects=n,this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new a(this.element.querySelector("ul").id,e)}}function p(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.trim().length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.trim().length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}c([n],d.prototype,"dragOverHandler",null),c([n],d.prototype,"dropHandler",null),c([n],d.prototype,"dragLeaveHandler",null);class u extends l{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}gatherUserInput(){const e=this.titleInputElement.value,t=this.descriptionInputElement.value,n=this.peopleInputElement.value,r={value:t,required:!0,minLength:5},s={value:+n,required:!0,min:1,max:5};return p({value:e,required:!0})&&p(r)&&p(s)?[e,t,+n]:void alert("Enter valid value, try again")}clearsInput(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;i.addProject(e,n,r),this.clearsInput()}}}(function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)})([n],u.prototype,"submitHandler",null),new u,new d("active"),new d("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwibWFwcGluZ3MiOiJtQkFFQSxJQUFZQSxHQUFaLFNBQVlBLEdBQ1YsdUJBQ0EsMEJBQ0QsQ0FIRCxDQUFZQSxJQUFBQSxFQUFhLEtBS2xCLE1BQU1DLEVBQ1gsV0FBQUMsQ0FDU0MsRUFDQUMsRUFDQUMsRUFDQUMsRUFDQUMsR0FKQSxLQUFBSixHQUFBQSxFQUNBLEtBQUFDLE1BQUFBLEVBQ0EsS0FBQUMsWUFBQUEsRUFDQSxLQUFBQyxPQUFBQSxFQUNBLEtBQUFDLE9BQUFBLENBQ04sRUNaRSxTQUFTQyxFQUNkQyxFQUNBQyxFQUNBQyxHQUVBLE1BQU1DLEVBQWlCRCxFQUFXRSxNQVNsQyxNQVIwQyxDQUN4Q0MsY0FBYyxFQUNkQyxZQUFZLEVBQ1osR0FBQUMsR0FFRSxPQURnQkosRUFBZUssS0FBS0MsS0FFdEMsRUFHSixDQ1pBLE1BQWVDLEVBQWYsY0FDWSxLQUFBQyxVQUEyQixFQUt2QyxDQUhFLFdBQUFDLENBQVlDLEdBQ1ZKLEtBQUtFLFVBQVVHLEtBQUtELEVBQ3RCLEVBR0ssTUFBTUUsVUFBcUJMLEVBSWhDLGNBQ0VNLFFBSk0sS0FBQUMsU0FBc0IsRUFLOUIsQ0FFQSxpQkFBT0MsR0FDTCxPQUFJVCxLQUFLVSxXQUdUVixLQUFLVSxTQUFXLElBQUlKLEdBRlhOLEtBQUtVLFFBSWhCLENBRUEsVUFBQUMsQ0FBV3pCLEVBQWUwQixFQUFvQkMsR0FDNUMsTUFBTUMsRUFBYSxJQUFJL0IsRUFDckJnQyxLQUFLQyxTQUFTQyxXQUNkL0IsRUFDQTBCLEVBQ0FDLEVBQ0EvQixFQUFjb0MsUUFFaEJsQixLQUFLUSxTQUFTSCxLQUFLUyxHQUNuQmQsS0FBS21CLGlCQUNQLENBRUEsV0FBQUMsQ0FBWUMsRUFBbUJDLEdBQzdCLE1BQU1DLEVBQVV2QixLQUFLUSxTQUFTZ0IsTUFBTUMsR0FBUUEsRUFBSXhDLEtBQU9vQyxJQUNuREUsR0FBV0EsRUFBUWxDLFNBQVdpQyxJQUNoQ0MsRUFBUWxDLE9BQVNpQyxFQUNqQnRCLEtBQUttQixrQkFFVCxDQUVRLGVBQUFBLEdBQ04sSUFBSyxNQUFNZixLQUFjSixLQUFLRSxVQUM1QkUsRUFBV0osS0FBS1EsU0FBU2tCLFFBRTdCLEVBSUssTUFBTUMsRUFBWXJCLEVBQWFHLGFDdkR2QixNQUFlbUIsRUFRNUIsV0FBQTVDLENBQ0U2QyxFQUNBQyxFQUNBQyxFQUNBQyxHQUVBaEMsS0FBS2lDLGdCQUFrQkMsU0FBU0MsZUFDOUJOLEdBRUY3QixLQUFLb0MsWUFBY0YsU0FBU0MsZUFBZUwsR0FDM0MsTUFBTU8sRUFBZUgsU0FBU0ksV0FDNUJ0QyxLQUFLaUMsZ0JBQWdCTSxTQUNyQixHQUVGdkMsS0FBS3dDLFFBQVVILEVBQWFJLGtCQUN4QlQsSUFBY2hDLEtBQUt3QyxRQUFRdkQsR0FBSytDLEdBRXBDaEMsS0FBSzBDLE9BQU9YLEVBQ2QsQ0FFUSxNQUFBVyxDQUFPQyxHQUNiM0MsS0FBS29DLFlBQVlRLHNCQUNmRCxFQUFtQixhQUFlLFlBQ2xDM0MsS0FBS3dDLFFBRVQsRSwwVUN4QkssTUFBTUssVUFDSGpCLEVBS1IsV0FBQTVDLENBQVk4RCxFQUFnQnZCLEdBQzFCaEIsTUFBTSxpQkFBa0J1QyxHQUFRLEVBQU92QixFQUFRdEMsSUFDL0NlLEtBQUt1QixRQUFVQSxFQUNmdkIsS0FBSytDLFlBQ0wvQyxLQUFLZ0QsZUFDUCxDQUVBLFdBQUlDLEdBQ0YsT0FBNEIsSUFBeEJqRCxLQUFLdUIsUUFBUW5DLE9BQ1IsV0FFRixHQUFHWSxLQUFLdUIsUUFBUW5DLGlCQUN6QixDQUdBLGdCQUFBOEQsQ0FBaUJDLEdBQ2ZBLEVBQU1DLGFBQWNDLFFBQVEsYUFBY3JELEtBQUt1QixRQUFRdEMsSUFDdkRrRSxFQUFNQyxhQUFjRSxjQUFnQixNQUN0QyxDQUVBLGNBQUFDLENBQWVoRSxHQUFlLENBRTlCLFNBQUF3RCxHQUNFL0MsS0FBS3dDLFFBQVFnQixpQkFBaUIsWUFBYXhELEtBQUtrRCxrQkFDaERsRCxLQUFLd0MsUUFBUWdCLGlCQUFpQixVQUFXeEQsS0FBS3VELGVBQ2hELENBRUEsYUFBQVAsR0FDRWhELEtBQUt3QyxRQUFRaUIsY0FBYyxNQUFPQyxZQUFjMUQsS0FBS3VCLFFBQVFyQyxNQUM3RGMsS0FBS3dDLFFBQVFpQixjQUFjLE1BQU9DLFlBQWMxRCxLQUFLaUQsUUFBVSxZQUMvRGpELEtBQUt3QyxRQUFRaUIsY0FBYyxLQUFNQyxZQUFjMUQsS0FBS3VCLFFBQVFwQyxXQUM5RCxFQWhCQSxHQURDRyxHLHFDQU1ELEdBRENBLEcsNldDdEJJLE1BQU1xRSxVQUNIL0IsRUFLUixXQUFBNUMsQ0FBb0I0RSxHQUNsQnJELE1BQU0sZUFBZ0IsT0FBTyxFQUFPLEdBQUdxRCxjQURyQixLQUFBQSxLQUFBQSxFQUdsQjVELEtBQUs2RCxpQkFBbUIsR0FFeEI3RCxLQUFLd0MsUUFBUXZELEdBQUssR0FBR2UsS0FBSzRELGdCQUUxQjVELEtBQUsrQyxZQUNML0MsS0FBS2dELGVBQ1AsQ0FHQSxlQUFBYyxDQUFnQlgsR0FDZEEsRUFBTVksaUJBQ0ZaLEVBQU1DLGNBQWdELGVBQWhDRCxFQUFNQyxhQUFhWSxNQUFNLElBQ2xDaEUsS0FBS3dDLFFBQVFpQixjQUFjLE1BQ25DUSxVQUFVQyxJQUFJLFlBRXpCLENBRUEsV0FBQUMsQ0FBWWhCLEdBQ1YsTUFBTWlCLEVBQU9qQixFQUFNQyxhQUFjaUIsUUFBUSxjQUV6QzFDLEVBQVVQLFlBQ1JnRCxFQUNjLFdBQWRwRSxLQUFLNEQsS0FBb0I5RSxFQUFjb0MsT0FBU3BDLEVBQWN3RixTQUVsRSxDQUVBLGdCQUFBQyxDQUFpQmhGLEdBQ0FTLEtBQUt3QyxRQUFRaUIsY0FBYyxNQUNuQ1EsVUFBVU8sT0FBTyxZQUMxQixDQUVBLFNBQUF6QixHQUNFL0MsS0FBS3dDLFFBQVFnQixpQkFBaUIsV0FBWXhELEtBQUs4RCxpQkFDL0M5RCxLQUFLd0MsUUFBUWdCLGlCQUFpQixZQUFheEQsS0FBS3VFLGtCQUNoRHZFLEtBQUt3QyxRQUFRZ0IsaUJBQWlCLE9BQVF4RCxLQUFLbUUsYUFFM0N4QyxFQUFVeEIsYUFBYUssSUFDckIsTUFBTWlFLEVBQW1CakUsRUFBU2tFLFFBQVFDLEdBQ3RCLFdBQWQzRSxLQUFLNEQsS0FDQWUsRUFBS3RGLFNBQVdQLEVBQWNvQyxPQUVoQ3lELEVBQUt0RixTQUFXUCxFQUFjd0YsV0FFdkN0RSxLQUFLNkQsaUJBQW1CWSxFQUN4QnpFLEtBQUs0RSxnQkFBZ0IsR0FFekIsQ0FFQSxhQUFBNUIsR0FDRSxNQUFNNkIsRUFBUyxHQUFHN0UsS0FBSzRELHFCQUN2QjVELEtBQUt3QyxRQUFRaUIsY0FBYyxNQUFPeEUsR0FBSzRGLEVBQ3ZDN0UsS0FBS3dDLFFBQVFpQixjQUFjLE1BQU9DLFlBQ2hDMUQsS0FBSzRELEtBQUtrQixjQUFnQixXQUM5QixDQUVRLGNBQUFGLEdBQ1MxQyxTQUFTQyxlQUN0QixHQUFHbkMsS0FBSzRELHNCQUVIbUIsVUFBWSxHQUNuQixJQUFLLE1BQU1DLEtBQVdoRixLQUFLNkQsaUJBSXpCLElBQUloQixFQUFZN0MsS0FBS3dDLFFBQVFpQixjQUFjLE1BQU94RSxHQUFJK0YsRUFFMUQsRUM5RUssU0FBU0MsRUFBVUMsR0FDeEIsSUFBSUMsR0FBVSxFQXdCZCxPQXZCSUQsRUFBY0UsV0FDaEJELEVBQVVBLEdBQTRELElBQWpERCxFQUFjdkYsTUFBTXNCLFdBQVdvRSxPQUFPQyxRQUdoQyxNQUEzQkosRUFBY0ssV0FDaUIsaUJBQXhCTCxFQUFjdkYsUUFFckJ3RixFQUNFQSxHQUFXRCxFQUFjdkYsTUFBTTBGLE9BQU9DLFFBQVVKLEVBQWNLLFdBR3JDLE1BQTNCTCxFQUFjTSxXQUNpQixpQkFBeEJOLEVBQWN2RixRQUVyQndGLEVBQ0VBLEdBQVdELEVBQWN2RixNQUFNMEYsT0FBT0MsUUFBVUosRUFBY00sV0FFekMsTUFBckJOLEVBQWNPLEtBQThDLGlCQUF4QlAsRUFBY3ZGLFFBQ3BEd0YsRUFBVUEsR0FBV0QsRUFBY3ZGLE9BQVN1RixFQUFjTyxLQUVuQyxNQUFyQlAsRUFBY1EsS0FBOEMsaUJBQXhCUixFQUFjdkYsUUFDcER3RixFQUFVQSxHQUFXRCxFQUFjdkYsT0FBU3VGLEVBQWNRLEtBRXJEUCxDQUNULENETEUsR0FEQzdGLEcsb0NBU0QsR0FEQ0EsRyxnQ0FVRCxHQURDQSxHLHFDRXJDSSxNQUFNcUcsVUFBcUIvRCxFQUtoQyxXQUFBNUMsR0FDRXVCLE1BQU0sZ0JBQWlCLE9BQU8sRUFBTSxjQUNwQ1AsS0FBSzRGLGtCQUFvQjVGLEtBQUt3QyxRQUFRaUIsY0FDcEMsVUFFRnpELEtBQUs2Rix3QkFBMEI3RixLQUFLd0MsUUFBUWlCLGNBQzFDLGdCQUVGekQsS0FBSzhGLG1CQUFxQjlGLEtBQUt3QyxRQUFRaUIsY0FDckMsV0FHRnpELEtBQUsrQyxXQUNQLENBRUEsU0FBQUEsR0FFRS9DLEtBQUt3QyxRQUFRZ0IsaUJBQWlCLFNBQVV4RCxLQUFLK0YsY0FDL0MsQ0FFQSxhQUFBL0MsR0FBaUIsQ0FFVCxlQUFBZ0QsR0FDTixNQUFNQyxFQUFlakcsS0FBSzRGLGtCQUFrQmpHLE1BQ3RDdUcsRUFBcUJsRyxLQUFLNkYsd0JBQXdCbEcsTUFDbER3RyxFQUFnQm5HLEtBQUs4RixtQkFBbUJuRyxNQU14Q3lHLEVBQWlELENBQ3JEekcsTUFBT3VHLEVBQ1BkLFVBQVUsRUFDVkcsVUFBVyxHQUVQYyxFQUE0QyxDQUNoRDFHLE9BQVF3RyxFQUNSZixVQUFVLEVBQ1ZLLElBQUssRUFDTEMsSUFBSyxHQUdQLE9BSUcsRUFwQjhDLENBQy9DL0YsTUFBT3NHLEVBQ1BiLFVBQVUsS0FtQlQsRUFBcUJnQixJQUNyQixFQUFxQkMsR0FLZixDQUFDSixFQUFjQyxHQUFxQkMsUUFIM0NHLE1BQU0sK0JBS1YsQ0FFUSxXQUFBQyxHQUNOdkcsS0FBSzRGLGtCQUFrQmpHLE1BQVEsR0FDL0JLLEtBQUs2Rix3QkFBd0JsRyxNQUFRLEdBQ3JDSyxLQUFLOEYsbUJBQW1CbkcsTUFBUSxFQUNsQyxDQUdRLGFBQUFvRyxDQUFjNUMsR0FDcEJBLEVBQU1ZLGlCQUNOLE1BQU15QyxFQUFZeEcsS0FBS2dHLGtCQUN2QixHQUFJUyxNQUFNQyxRQUFRRixHQUFZLENBQzVCLE1BQU9HLEVBQUtDLEVBQUtDLEdBQU9MLEVBQ3hCN0UsRUFBVWhCLFdBQVdnRyxFQUFLQyxFQUFLQyxHQUMvQjdHLEtBQUt1RyxhQUNQLENBQ0YsRywyVEFSUSxFQURQakgsRyxrQ0N0RUgsSUFBSXFHLEVBQ0osSUFBSWhDLEVBQVksVUFDaEIsSUFBSUEsRUFBWSxXIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHMtdGVzdC8uL3NyYy9tb2RlbHMvcHJvamVjdC50cyIsIndlYnBhY2s6Ly90cy10ZXN0Ly4vc3JjL2RlY29yYXRvcnMvYXV0b2JpbmQtZGVjb3JhdG9yLnRzIiwid2VicGFjazovL3RzLXRlc3QvLi9zcmMvc3RhdGUvcHJvamVjdC50cyIsIndlYnBhY2s6Ly90cy10ZXN0Ly4vc3JjL2NvbXBvbmVudHMvYmFzZS1jb21wb25lbnRzLnRzIiwid2VicGFjazovL3RzLXRlc3QvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWl0ZW0udHMiLCJ3ZWJwYWNrOi8vdHMtdGVzdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtbGlzdC50cyIsIndlYnBhY2s6Ly90cy10ZXN0Ly4vc3JjL3V0aWwvdmFsaWRhdGlvbi50cyIsIndlYnBhY2s6Ly90cy10ZXN0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dC50cyIsIndlYnBhY2s6Ly90cy10ZXN0Ly4vc3JjL2FwcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBuYW1lc3BhY2UgQXBwIHtcclxuLy8gUHJvamVjdCBUeXBlXHJcbmV4cG9ydCBlbnVtIFByb2plY3RTdGF0dXMge1xyXG4gIEFjdGl2ZSxcclxuICBGaW5pc2hlZCxcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFByb2plY3Qge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIGlkOiBzdHJpbmcsXHJcbiAgICBwdWJsaWMgdGl0bGU6IHN0cmluZyxcclxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nLFxyXG4gICAgcHVibGljIHBlb3BsZTogbnVtYmVyLFxyXG4gICAgcHVibGljIHN0YXR1czogUHJvamVjdFN0YXR1c1xyXG4gICkge31cclxufVxyXG4vLyB9XHJcbiIsIi8vIG5hbWVzcGFjZSBBcHAge1xyXG4vLyBkZWNvcmF0b3JcclxuZXhwb3J0IGZ1bmN0aW9uIGF1dG9iaW5kKFxyXG4gIF86IGFueSxcclxuICBfMjogc3RyaW5nIHwgU3ltYm9sLFxyXG4gIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvclxyXG4pIHtcclxuICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XHJcbiAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xyXG4gICAgY29uZmlndXJhYmxlOiB0cnVlLFxyXG4gICAgZW51bWVyYWJsZTogZmFsc2UsXHJcbiAgICBnZXQoKSB7XHJcbiAgICAgIGNvbnN0IGJvdW5kRm4gPSBvcmlnaW5hbE1ldGhvZC5iaW5kKHRoaXMpO1xyXG4gICAgICByZXR1cm4gYm91bmRGbjtcclxuICAgIH0sXHJcbiAgfTtcclxuICByZXR1cm4gYWRqRGVzY3JpcHRvcjtcclxufVxyXG4vLyB9XHJcbiIsImltcG9ydCB7IFByb2plY3QsIFByb2plY3RTdGF0dXMgfSBmcm9tIFwiLi4vbW9kZWxzL3Byb2plY3RcIjtcclxuXHJcbi8vIG5hbWVzcGFjZSBBcHAge1xyXG50eXBlIExpc3RlbmVyPFQ+ID0gKGl0ZW1zOiBUW10pID0+IHZvaWQ7XHJcblxyXG5hYnN0cmFjdCBjbGFzcyBTdGF0ZTxUPiB7XHJcbiAgcHJvdGVjdGVkIGxpc3RlbmVyczogTGlzdGVuZXI8VD5bXSA9IFtdO1xyXG5cclxuICBhZGRMaXN0ZW5lcihsaXN0ZW5lckZuOiBMaXN0ZW5lcjxUPikge1xyXG4gICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lckZuKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBQcm9qZWN0U3RhdGUgZXh0ZW5kcyBTdGF0ZTxQcm9qZWN0PiB7XHJcbiAgcHJpdmF0ZSBwcm9qZWN0czogUHJvamVjdFtdID0gW107XHJcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFByb2plY3RTdGF0ZTtcclxuXHJcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZ2V0SW5zdGFjZSgpIHtcclxuICAgIGlmICh0aGlzLmluc3RhbmNlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbnN0YW5jZSA9IG5ldyBQcm9qZWN0U3RhdGUoKTtcclxuICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xyXG4gIH1cclxuXHJcbiAgYWRkUHJvamVjdCh0aXRsZTogc3RyaW5nLCBkZXNyaXB0aW9uOiBzdHJpbmcsIG51bU9mUGVvcGxlOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG5ld1Byb2plY3QgPSBuZXcgUHJvamVjdChcclxuICAgICAgTWF0aC5yYW5kb20oKS50b1N0cmluZygpLFxyXG4gICAgICB0aXRsZSxcclxuICAgICAgZGVzcmlwdGlvbixcclxuICAgICAgbnVtT2ZQZW9wbGUsXHJcbiAgICAgIFByb2plY3RTdGF0dXMuQWN0aXZlXHJcbiAgICApO1xyXG4gICAgdGhpcy5wcm9qZWN0cy5wdXNoKG5ld1Byb2plY3QpO1xyXG4gICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIG1vdmVQcm9qZWN0KHByb2plY3RJZDogc3RyaW5nLCBuZXdTdGF0dXM6IFByb2plY3RTdGF0dXMpIHtcclxuICAgIGNvbnN0IHByb2plY3QgPSB0aGlzLnByb2plY3RzLmZpbmQoKHByaikgPT4gcHJqLmlkID09PSBwcm9qZWN0SWQpO1xyXG4gICAgaWYgKHByb2plY3QgJiYgcHJvamVjdC5zdGF0dXMgIT09IG5ld1N0YXR1cykge1xyXG4gICAgICBwcm9qZWN0LnN0YXR1cyA9IG5ld1N0YXR1cztcclxuICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlTGlzdGVuZXJzKCkge1xyXG4gICAgZm9yIChjb25zdCBsaXN0ZW5lckZuIG9mIHRoaXMubGlzdGVuZXJzKSB7XHJcbiAgICAgIGxpc3RlbmVyRm4odGhpcy5wcm9qZWN0cy5zbGljZSgpKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIHNpbmdsZXRvblxyXG5leHBvcnQgY29uc3QgcHJvalN0YXRlID0gUHJvamVjdFN0YXRlLmdldEluc3RhY2UoKTtcclxuLy8gfVxyXG4iLCIvLyBuYW1lc3BhY2UgQXBwIHtcclxuLy8gUHJvamVjdEJhc2VcclxuZXhwb3J0IGRlZmF1bHQgYWJzdHJhY3QgY2xhc3MgQ29tcG9uZW50PFxyXG4gIFQgZXh0ZW5kcyBIVE1MRWxlbWVudCxcclxuICBVIGV4dGVuZHMgSFRNTEVsZW1lbnRcclxuPiB7XHJcbiAgdGVtcGxhdGVFbGVtZW50OiBIVE1MVGVtcGxhdGVFbGVtZW50O1xyXG4gIGhvc3RFbGVtZW50OiBUO1xyXG4gIGVsZW1lbnQ6IFU7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgdGVtcGxhdGVJZDogc3RyaW5nLFxyXG4gICAgaG9zdEVsZW1lbnRJZDogc3RyaW5nLFxyXG4gICAgaW5zZXJ0ZWRBdFN0YXJ0OiBib29sZWFuLFxyXG4gICAgbmV3RWxlbWVudElkPzogc3RyaW5nXHJcbiAgKSB7XHJcbiAgICB0aGlzLnRlbXBsYXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxyXG4gICAgICB0ZW1wbGF0ZUlkXHJcbiAgICApISBhcyBIVE1MVGVtcGxhdGVFbGVtZW50O1xyXG4gICAgdGhpcy5ob3N0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhvc3RFbGVtZW50SWQpISBhcyBUO1xyXG4gICAgY29uc3QgaW1wb3J0ZWROb2RlID0gZG9jdW1lbnQuaW1wb3J0Tm9kZShcclxuICAgICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudCxcclxuICAgICAgdHJ1ZVxyXG4gICAgKTtcclxuICAgIHRoaXMuZWxlbWVudCA9IGltcG9ydGVkTm9kZS5maXJzdEVsZW1lbnRDaGlsZCBhcyBVO1xyXG4gICAgaWYgKG5ld0VsZW1lbnRJZCkgdGhpcy5lbGVtZW50LmlkID0gbmV3RWxlbWVudElkO1xyXG5cclxuICAgIHRoaXMuYXR0YWNoKGluc2VydGVkQXRTdGFydCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGF0dGFjaChpbnNlcnRBdEJlZ2luaW5nOiBib29sZWFuKSB7XHJcbiAgICB0aGlzLmhvc3RFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudChcclxuICAgICAgaW5zZXJ0QXRCZWdpbmluZyA/IFwiYWZ0ZXJiZWdpblwiIDogXCJiZWZvcmVlbmRcIixcclxuICAgICAgdGhpcy5lbGVtZW50XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYWJzdHJhY3QgY29uZmlndXJlKCk6IHZvaWQ7XHJcbiAgYWJzdHJhY3QgcmVuZGVyQ29udGVudCgpOiB2b2lkO1xyXG59XHJcbi8vIH1cclxuIiwiLy8gLy8vIDxyZWZlcmVuY2UgcGF0aCA9IFwiLi4vbW9kZWxzL2RyYWctZHJvcC1pbnRlcmZhY2VzLnRzXCIgLz5cclxuLy8gLy8vIDxyZWZlcmVuY2UgcGF0aCA9IFwiLi4vbW9kZWxzL3Byb2plY3QudHNcIiAvPlxyXG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoID0gXCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kLWRlY29yYXRvci50c1wiIC8+XHJcbi8vIC8vLyA8cmVmZXJlbmNlIHBhdGggPSBcIi4uL2NvbXBvbmVudHMvYmFzZS1jb21wb25lbnRzLnRzXCIgLz5cclxuXHJcbmltcG9ydCB7IERyYWdnYWJsZSB9IGZyb20gXCIuLi9tb2RlbHMvZHJhZy1kcm9wLWludGVyZmFjZXNcIjtcclxuaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdFwiO1xyXG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gXCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kLWRlY29yYXRvclwiO1xyXG5pbXBvcnQgQ29tcG9uZW50IGZyb20gXCIuLi9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50c1wiO1xyXG5cclxuLy8gbmFtZXNwYWNlIEFwcCB7XHJcbmV4cG9ydCBjbGFzcyBQcm9qZWN0SXRlbVxyXG4gIGV4dGVuZHMgQ29tcG9uZW50PEhUTUxVTGlzdEVsZW1lbnQsIEhUTUxMSUVsZW1lbnQ+XHJcbiAgaW1wbGVtZW50cyBEcmFnZ2FibGVcclxue1xyXG4gIHByaXZhdGUgcHJvamVjdDogUHJvamVjdDtcclxuXHJcbiAgY29uc3RydWN0b3IoaG9zdElkOiBzdHJpbmcsIHByb2plY3Q6IFByb2plY3QpIHtcclxuICAgIHN1cGVyKFwic2luZ2xlLXByb2plY3RcIiwgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XHJcbiAgICB0aGlzLnByb2plY3QgPSBwcm9qZWN0O1xyXG4gICAgdGhpcy5jb25maWd1cmUoKTtcclxuICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHBlcnNvbnMoKSB7XHJcbiAgICBpZiAodGhpcy5wcm9qZWN0LnBlb3BsZSA9PT0gMSkge1xyXG4gICAgICByZXR1cm4gXCIxIHBlcnNvblwiO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGAke3RoaXMucHJvamVjdC5wZW9wbGV9IHBlcnNvbnMgYDtcclxuICB9XHJcblxyXG4gIEBhdXRvYmluZFxyXG4gIGRyYWdTdGFydEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xyXG4gICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5zZXREYXRhKFwidGV4dC9wbGFpblwiLCB0aGlzLnByb2plY3QuaWQpO1xyXG4gICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5lZmZlY3RBbGxvd2VkID0gXCJtb3ZlXCI7XHJcbiAgfVxyXG4gIEBhdXRvYmluZFxyXG4gIGRyYWdFbmRIYW5kbGVyKF86IERyYWdFdmVudCkge31cclxuXHJcbiAgY29uZmlndXJlKCkge1xyXG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnc3RhcnRcIiwgdGhpcy5kcmFnU3RhcnRIYW5kbGVyKTtcclxuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VuZFwiLCB0aGlzLmRyYWdFbmRIYW5kbGVyKTtcclxuICB9XHJcblxyXG4gIHJlbmRlckNvbnRlbnQoKSB7XHJcbiAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcImgyXCIpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC50aXRsZTtcclxuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDNcIikhLnRleHRDb250ZW50ID0gdGhpcy5wZXJzb25zICsgXCIgYXNzaWduZWRcIjtcclxuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwicFwiKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QuZGVzY3JpcHRpb247XHJcbiAgfVxyXG59XHJcbi8vIH1cclxuIiwiLy8gLy8vIDxyZWZlcmVuY2UgcGF0aCA9IFwiLi4vbW9kZWxzL2RyYWctZHJvcC1pbnRlcmZhY2VzLnRzXCIgLz5cclxuLy8gLy8vIDxyZWZlcmVuY2UgcGF0aCA9IFwiLi4vbW9kZWxzL3Byb2plY3QudHNcIiAvPlxyXG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoID0gXCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kLWRlY29yYXRvci50c1wiIC8+XHJcbi8vIC8vLyA8cmVmZXJlbmNlIHBhdGggPSBcIi4uL3N0YXRlL3Byb2plY3QudHNcIiAvPlxyXG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoID0gXCIuLi9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50cy50c1wiIC8+XHJcblxyXG5pbXBvcnQgeyBEcmFnVGFyZ2V0IH0gZnJvbSBcIi4uL21vZGVscy9kcmFnLWRyb3AtaW50ZXJmYWNlc1wiO1xyXG5pbXBvcnQgeyBQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSBcIi4uL21vZGVscy9wcm9qZWN0XCI7XHJcbmltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmQtZGVjb3JhdG9yXCI7XHJcbmltcG9ydCB7IHByb2pTdGF0ZSB9IGZyb20gXCIuLi9zdGF0ZS9wcm9qZWN0XCI7XHJcbmltcG9ydCBDb21wb25lbnQgZnJvbSBcIi4uL2NvbXBvbmVudHMvYmFzZS1jb21wb25lbnRzXCI7XHJcbmltcG9ydCB7IFByb2plY3RJdGVtIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvcHJvamVjdC1pdGVtXCI7XHJcblxyXG4vLyBuYW1lc3BhY2UgQXBwIHtcclxuZXhwb3J0IGNsYXNzIFByb2plY3RMaXN0XHJcbiAgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxFbGVtZW50PlxyXG4gIGltcGxlbWVudHMgRHJhZ1RhcmdldFxyXG57XHJcbiAgYXNzaWduZWRQcm9qZWN0czogUHJvamVjdFtdO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHR5cGU6IFwiYWN0aXZlXCIgfCBcImZpbmlzaGVkXCIpIHtcclxuICAgIHN1cGVyKFwicHJvamVjdC1saXN0XCIsIFwiYXBwXCIsIGZhbHNlLCBgJHt0eXBlfS1wcm9qZWN0c2ApO1xyXG5cclxuICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IFtdO1xyXG5cclxuICAgIHRoaXMuZWxlbWVudC5pZCA9IGAke3RoaXMudHlwZX0tcHJvamVjdHNgO1xyXG5cclxuICAgIHRoaXMuY29uZmlndXJlKCk7XHJcbiAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcclxuICB9XHJcblxyXG4gIEBhdXRvYmluZFxyXG4gIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgaWYgKGV2ZW50LmRhdGFUcmFuc2ZlciAmJiBldmVudC5kYXRhVHJhbnNmZXIudHlwZXNbMF0gPT09IFwidGV4dC9wbGFpblwiKSB7XHJcbiAgICAgIGNvbnN0IGxpc3RFbCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhO1xyXG4gICAgICBsaXN0RWwuY2xhc3NMaXN0LmFkZChcImRyb3BwYWJsZVwiKTtcclxuICAgIH1cclxuICB9XHJcbiAgQGF1dG9iaW5kXHJcbiAgZHJvcEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xyXG4gICAgY29uc3QgcHJJZCA9IGV2ZW50LmRhdGFUcmFuc2ZlciEuZ2V0RGF0YShcInRleHQvcGxhaW5cIik7XHJcblxyXG4gICAgcHJvalN0YXRlLm1vdmVQcm9qZWN0KFxyXG4gICAgICBwcklkLFxyXG4gICAgICB0aGlzLnR5cGUgPT09IFwiYWN0aXZlXCIgPyBQcm9qZWN0U3RhdHVzLkFjdGl2ZSA6IFByb2plY3RTdGF0dXMuRmluaXNoZWRcclxuICAgICk7XHJcbiAgfVxyXG4gIEBhdXRvYmluZFxyXG4gIGRyYWdMZWF2ZUhhbmRsZXIoXzogRHJhZ0V2ZW50KSB7XHJcbiAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpITtcclxuICAgIGxpc3RFbC5jbGFzc0xpc3QucmVtb3ZlKFwiZHJvcHBhYmxlXCIpO1xyXG4gIH1cclxuXHJcbiAgY29uZmlndXJlKCkge1xyXG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCB0aGlzLmRyYWdPdmVySGFuZGxlcik7XHJcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdsZWF2ZVwiLCB0aGlzLmRyYWdMZWF2ZUhhbmRsZXIpO1xyXG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIHRoaXMuZHJvcEhhbmRsZXIpO1xyXG5cclxuICAgIHByb2pTdGF0ZS5hZGRMaXN0ZW5lcigocHJvamVjdHM6IFByb2plY3RbXSkgPT4ge1xyXG4gICAgICBjb25zdCByZWxldmFudFByb2plY3RzID0gcHJvamVjdHMuZmlsdGVyKChwcm9qKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIikge1xyXG4gICAgICAgICAgcmV0dXJuIHByb2ouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkFjdGl2ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHByb2ouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5hc3NpZ25lZFByb2plY3RzID0gcmVsZXZhbnRQcm9qZWN0cztcclxuICAgICAgdGhpcy5yZW5kZXJQcm9qZWN0cygpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJDb250ZW50KCkge1xyXG4gICAgY29uc3QgbGlzdElkID0gYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YDtcclxuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmlkID0gbGlzdElkO1xyXG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMlwiKSEudGV4dENvbnRlbnQgPVxyXG4gICAgICB0aGlzLnR5cGUudG9VcHBlckNhc2UoKSArIFwiIFBST0pFQ1RTXCI7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlclByb2plY3RzKCkge1xyXG4gICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXHJcbiAgICAgIGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGBcclxuICAgICkhIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XHJcbiAgICBsaXN0RWwuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgIGZvciAoY29uc3QgcHJqSXRlbSBvZiB0aGlzLmFzc2lnbmVkUHJvamVjdHMpIHtcclxuICAgICAgLy8gY29uc3QgbGlzdEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XHJcbiAgICAgIC8vIGxpc3RJdGVtLnRleHRDb250ZW50ID0gcHJqSXRlbS50aXRsZTtcclxuICAgICAgLy8gbGlzdEVsLmFwcGVuZENoaWxkKGxpc3RJdGVtKTtcclxuICAgICAgbmV3IFByb2plY3RJdGVtKHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmlkLCBwcmpJdGVtKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuLy8gfVxyXG4iLCIvLyBuYW1lc3BhY2UgQXBwIHtcclxuLy8gdmFsaWRhdGlvblxyXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRhYmxlIHtcclxuICB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyO1xyXG4gIHJlcXVpcmVkPzogYm9vbGVhbjtcclxuICBtaW5MZW5ndGg/OiBudW1iZXI7XHJcbiAgbWF4TGVuZ3RoPzogbnVtYmVyO1xyXG4gIG1pbj86IG51bWJlcjtcclxuICBtYXg/OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZXModmFsaWRhdGVJbnB1dDogVmFsaWRhdGFibGUpIHtcclxuICBsZXQgaXNWYWxpZCA9IHRydWU7XHJcbiAgaWYgKHZhbGlkYXRlSW5wdXQucmVxdWlyZWQpIHtcclxuICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwO1xyXG4gIH1cclxuICBpZiAoXHJcbiAgICB2YWxpZGF0ZUlucHV0Lm1pbkxlbmd0aCAhPSBudWxsICYmXHJcbiAgICB0eXBlb2YgdmFsaWRhdGVJbnB1dC52YWx1ZSA9PT0gXCJzdHJpbmdcIlxyXG4gICkge1xyXG4gICAgaXNWYWxpZCA9XHJcbiAgICAgIGlzVmFsaWQgJiYgdmFsaWRhdGVJbnB1dC52YWx1ZS50cmltKCkubGVuZ3RoID49IHZhbGlkYXRlSW5wdXQubWluTGVuZ3RoO1xyXG4gIH1cclxuICBpZiAoXHJcbiAgICB2YWxpZGF0ZUlucHV0Lm1heExlbmd0aCAhPSBudWxsICYmXHJcbiAgICB0eXBlb2YgdmFsaWRhdGVJbnB1dC52YWx1ZSA9PT0gXCJzdHJpbmdcIlxyXG4gICkge1xyXG4gICAgaXNWYWxpZCA9XHJcbiAgICAgIGlzVmFsaWQgJiYgdmFsaWRhdGVJbnB1dC52YWx1ZS50cmltKCkubGVuZ3RoIDw9IHZhbGlkYXRlSW5wdXQubWF4TGVuZ3RoO1xyXG4gIH1cclxuICBpZiAodmFsaWRhdGVJbnB1dC5taW4gIT0gbnVsbCAmJiB0eXBlb2YgdmFsaWRhdGVJbnB1dC52YWx1ZSA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGVJbnB1dC52YWx1ZSA+PSB2YWxpZGF0ZUlucHV0Lm1pbjtcclxuICB9XHJcbiAgaWYgKHZhbGlkYXRlSW5wdXQubWF4ICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRlSW5wdXQudmFsdWUgPT09IFwibnVtYmVyXCIpIHtcclxuICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRlSW5wdXQudmFsdWUgPD0gdmFsaWRhdGVJbnB1dC5tYXg7XHJcbiAgfVxyXG4gIHJldHVybiBpc1ZhbGlkO1xyXG59XHJcbi8vIH1cclxuIiwiLy8gLy8vIDxyZWZlcmVuY2UgcGF0aCA9IFwiLi4vdXRpbC92YWxpZGF0aW9uLnRzXCIgLz5cclxuLy8gLy8vIDxyZWZlcmVuY2UgcGF0aCA9IFwiLi4vZGVjb3JhdG9ycy9hdXRvYmluZC1kZWNvcmF0b3IudHNcIiAvPlxyXG4vLyAvLy8gPHJlZmVyZW5jZSBwYXRoID0gXCIuLi9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50cy50c1wiIC8+XHJcbi8vIC8vLyA8cmVmZXJlbmNlIHBhdGggPSBcIi4uL3N0YXRlL3Byb2plY3QudHNcIiAvPlxyXG5cclxuaW1wb3J0ICogYXMgVmFsaWRhdGlvbiBmcm9tIFwiLi4vdXRpbC92YWxpZGF0aW9uXCI7XHJcbmltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmQtZGVjb3JhdG9yXCI7XHJcbmltcG9ydCBDb21wb25lbnQgZnJvbSBcIi4uL2NvbXBvbmVudHMvYmFzZS1jb21wb25lbnRzXCI7XHJcbmltcG9ydCB7IHByb2pTdGF0ZSB9IGZyb20gXCIuLi9zdGF0ZS9wcm9qZWN0XCI7XHJcblxyXG4vLyBuYW1lc3BhY2UgQXBwIHtcclxuZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEZvcm1FbGVtZW50PiB7XHJcbiAgdGl0bGVJbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgcGVvcGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKFwicHJvamVjdC1pbnB1dFwiLCBcImFwcFwiLCB0cnVlLCBcInVzZXItaW5wdXRcIik7XHJcbiAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIFwiI3RpdGxlXCJcclxuICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIjZGVzY3JpcHRpb25cIlxyXG4gICAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIjcGVvcGxlXCJcclxuICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcclxuXHJcbiAgICB0aGlzLmNvbmZpZ3VyZSgpO1xyXG4gIH1cclxuXHJcbiAgY29uZmlndXJlKCkge1xyXG4gICAgLy8gdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5zdWJtaXRIYW5kbGVyLmJpbmQodGhpcykpO1xyXG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5zdWJtaXRIYW5kbGVyKTtcclxuICB9XHJcblxyXG4gIHJlbmRlckNvbnRlbnQoKSB7fVxyXG5cclxuICBwcml2YXRlIGdhdGhlclVzZXJJbnB1dCgpOiBbc3RyaW5nLCBzdHJpbmcsIG51bWJlcl0gfCB2b2lkIHtcclxuICAgIGNvbnN0IGVudGVyZWRUaXRsZSA9IHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWU7XHJcbiAgICBjb25zdCBlbnRlcmVkRGVzY3JpcHRpb24gPSB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlO1xyXG4gICAgY29uc3QgZW50ZXJlZFBlb3BsZSA9IHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlO1xyXG5cclxuICAgIGNvbnN0IHRpdGxlVmFsaWRhdGFibGU6IFZhbGlkYXRpb24uVmFsaWRhdGFibGUgPSB7XHJcbiAgICAgIHZhbHVlOiBlbnRlcmVkVGl0bGUsXHJcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgfTtcclxuICAgIGNvbnN0IGRlc2NyaXB0aW9uVmFsaWRhdGFibGU6IFZhbGlkYXRpb24uVmFsaWRhdGFibGUgPSB7XHJcbiAgICAgIHZhbHVlOiBlbnRlcmVkRGVzY3JpcHRpb24sXHJcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICBtaW5MZW5ndGg6IDUsXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcGVvcGxlVmFsaWRhdGFibGU6IFZhbGlkYXRpb24uVmFsaWRhdGFibGUgPSB7XHJcbiAgICAgIHZhbHVlOiArZW50ZXJlZFBlb3BsZSxcclxuICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgIG1pbjogMSxcclxuICAgICAgbWF4OiA1LFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoXHJcbiAgICAgIC8vIGVudGVyZWRUaXRsZS50cmltKCkubGVuZ3RoID09PSAwIHx8XHJcbiAgICAgIC8vIGVudGVyZWRkRGVzY3JpcHRpb24udHJpbSgpLmxlbmd0aCA9PT0gMCB8fFxyXG4gICAgICAvLyBlbnRlcmVkUGVvcGxlLnRyaW0oKS5sZW5ndGggPT09IDBcclxuICAgICAgIVZhbGlkYXRpb24udmFsaWRhdGVzKHRpdGxlVmFsaWRhdGFibGUpIHx8XHJcbiAgICAgICFWYWxpZGF0aW9uLnZhbGlkYXRlcyhkZXNjcmlwdGlvblZhbGlkYXRhYmxlKSB8fFxyXG4gICAgICAhVmFsaWRhdGlvbi52YWxpZGF0ZXMocGVvcGxlVmFsaWRhdGFibGUpXHJcbiAgICApIHtcclxuICAgICAgYWxlcnQoXCJFbnRlciB2YWxpZCB2YWx1ZSwgdHJ5IGFnYWluXCIpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gW2VudGVyZWRUaXRsZSwgZW50ZXJlZERlc2NyaXB0aW9uLCArZW50ZXJlZFBlb3BsZV07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNsZWFyc0lucHV0KCkge1xyXG4gICAgdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XHJcbiAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcclxuICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcclxuICB9XHJcblxyXG4gIEBhdXRvYmluZFxyXG4gIHByaXZhdGUgc3VibWl0SGFuZGxlcihldmVudDogRXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpO1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodXNlcklucHV0KSkge1xyXG4gICAgICBjb25zdCBbdGl0LCBkZXMsIHBlcF0gPSB1c2VySW5wdXQ7XHJcbiAgICAgIHByb2pTdGF0ZS5hZGRQcm9qZWN0KHRpdCwgZGVzLCBwZXApO1xyXG4gICAgICB0aGlzLmNsZWFyc0lucHV0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbi8vIH1cclxuIiwiLy8gLy8vIDxyZWZlcmVuY2UgcGF0aCA9IFwiLi9jb21wb25lbnRzL3Byb2plY3QtbGlzdC50c1wiIC8+XHJcbi8vIC8vLyA8cmVmZXJlbmNlIHBhdGggPSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWlucHV0LnRzXCIgLz5cclxuXHJcbi8vIGltcG9ydCB7IFByb2plY3RMaXN0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWxpc3QuanNcIjtcclxuLy8gaW1wb3J0IHsgUHJvamVjdElucHV0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWlucHV0LmpzXCI7XHJcblxyXG5pbXBvcnQgeyBQcm9qZWN0TGlzdCB9IGZyb20gXCIuL2NvbXBvbmVudHMvcHJvamVjdC1saXN0XCI7XHJcbmltcG9ydCB7IFByb2plY3RJbnB1dCB9IGZyb20gXCIuL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dFwiO1xyXG5cclxuLy8gbmFtZXNwYWNlIEFwcCB7XHJcbm5ldyBQcm9qZWN0SW5wdXQoKTtcclxubmV3IFByb2plY3RMaXN0KFwiYWN0aXZlXCIpO1xyXG5uZXcgUHJvamVjdExpc3QoXCJmaW5pc2hlZFwiKTtcclxuLy8gfVxyXG4iXSwibmFtZXMiOlsiUHJvamVjdFN0YXR1cyIsIlByb2plY3QiLCJjb25zdHJ1Y3RvciIsImlkIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInBlb3BsZSIsInN0YXR1cyIsImF1dG9iaW5kIiwiXyIsIl8yIiwiZGVzY3JpcHRvciIsIm9yaWdpbmFsTWV0aG9kIiwidmFsdWUiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiYmluZCIsInRoaXMiLCJTdGF0ZSIsImxpc3RlbmVycyIsImFkZExpc3RlbmVyIiwibGlzdGVuZXJGbiIsInB1c2giLCJQcm9qZWN0U3RhdGUiLCJzdXBlciIsInByb2plY3RzIiwiZ2V0SW5zdGFjZSIsImluc3RhbmNlIiwiYWRkUHJvamVjdCIsImRlc3JpcHRpb24iLCJudW1PZlBlb3BsZSIsIm5ld1Byb2plY3QiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJBY3RpdmUiLCJ1cGRhdGVMaXN0ZW5lcnMiLCJtb3ZlUHJvamVjdCIsInByb2plY3RJZCIsIm5ld1N0YXR1cyIsInByb2plY3QiLCJmaW5kIiwicHJqIiwic2xpY2UiLCJwcm9qU3RhdGUiLCJDb21wb25lbnQiLCJ0ZW1wbGF0ZUlkIiwiaG9zdEVsZW1lbnRJZCIsImluc2VydGVkQXRTdGFydCIsIm5ld0VsZW1lbnRJZCIsInRlbXBsYXRlRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJob3N0RWxlbWVudCIsImltcG9ydGVkTm9kZSIsImltcG9ydE5vZGUiLCJjb250ZW50IiwiZWxlbWVudCIsImZpcnN0RWxlbWVudENoaWxkIiwiYXR0YWNoIiwiaW5zZXJ0QXRCZWdpbmluZyIsImluc2VydEFkamFjZW50RWxlbWVudCIsIlByb2plY3RJdGVtIiwiaG9zdElkIiwiY29uZmlndXJlIiwicmVuZGVyQ29udGVudCIsInBlcnNvbnMiLCJkcmFnU3RhcnRIYW5kbGVyIiwiZXZlbnQiLCJkYXRhVHJhbnNmZXIiLCJzZXREYXRhIiwiZWZmZWN0QWxsb3dlZCIsImRyYWdFbmRIYW5kbGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsIlByb2plY3RMaXN0IiwidHlwZSIsImFzc2lnbmVkUHJvamVjdHMiLCJkcmFnT3ZlckhhbmRsZXIiLCJwcmV2ZW50RGVmYXVsdCIsInR5cGVzIiwiY2xhc3NMaXN0IiwiYWRkIiwiZHJvcEhhbmRsZXIiLCJwcklkIiwiZ2V0RGF0YSIsIkZpbmlzaGVkIiwiZHJhZ0xlYXZlSGFuZGxlciIsInJlbW92ZSIsInJlbGV2YW50UHJvamVjdHMiLCJmaWx0ZXIiLCJwcm9qIiwicmVuZGVyUHJvamVjdHMiLCJsaXN0SWQiLCJ0b1VwcGVyQ2FzZSIsImlubmVySFRNTCIsInByakl0ZW0iLCJ2YWxpZGF0ZXMiLCJ2YWxpZGF0ZUlucHV0IiwiaXNWYWxpZCIsInJlcXVpcmVkIiwidHJpbSIsImxlbmd0aCIsIm1pbkxlbmd0aCIsIm1heExlbmd0aCIsIm1pbiIsIm1heCIsIlByb2plY3RJbnB1dCIsInRpdGxlSW5wdXRFbGVtZW50IiwiZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQiLCJwZW9wbGVJbnB1dEVsZW1lbnQiLCJzdWJtaXRIYW5kbGVyIiwiZ2F0aGVyVXNlcklucHV0IiwiZW50ZXJlZFRpdGxlIiwiZW50ZXJlZERlc2NyaXB0aW9uIiwiZW50ZXJlZFBlb3BsZSIsImRlc2NyaXB0aW9uVmFsaWRhdGFibGUiLCJwZW9wbGVWYWxpZGF0YWJsZSIsImFsZXJ0IiwiY2xlYXJzSW5wdXQiLCJ1c2VySW5wdXQiLCJBcnJheSIsImlzQXJyYXkiLCJ0aXQiLCJkZXMiLCJwZXAiXSwic291cmNlUm9vdCI6IiJ9